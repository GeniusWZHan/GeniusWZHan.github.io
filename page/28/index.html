<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="kongwenqiang" />


    
    


<meta name="description" content="喜欢Java，NodeJS, Golang">
<meta property="og:type" content="website">
<meta property="og:title" content="戒修-沉迷技术的小沙弥">
<meta property="og:url" content="https://leokongwq.github.io/page/28/index.html">
<meta property="og:site_name" content="戒修-沉迷技术的小沙弥">
<meta property="og:description" content="喜欢Java，NodeJS, Golang">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="戒修-沉迷技术的小沙弥">
<meta name="twitter:description" content="喜欢Java，NodeJS, Golang">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="戒修-沉迷技术的小沙弥" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>戒修-沉迷技术的小沙弥</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<script src="/js/search.js"></script>
<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">kongwenqiang</a></h1>
        </hgroup>

        
        <p class="header-subtitle">我喜欢GO</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:leokongwq@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/leokongwq" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/">AOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveMQ/">ActiveMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveQM/">ActiveQM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDD/">DDD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DNS/">DNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GO/">GO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK8/">JDK8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MQ/">MQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NET/">NET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openresy/">Openresy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REST/">REST</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RestTemplate/">RestTemplate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algo/">algo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aop/">aop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cache/">cache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/computer/">computer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/consul/">consul</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/curator/">curator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/curl/">curl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/">devops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devtools/">devtools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gossip/">gossip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/guava/">guava</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java8/">java8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdk/">jdk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jekyll/">jekyll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/">json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jta/">jta</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/">jvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lua/">lua</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/microservices/">microservices</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mq/">mq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netty/">netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth2/">oauth2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openresty/">openresty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/osx/">osx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pig/">pig</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/resin/">resin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/servlet3/">servlet3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/soa/">soa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-mvc/">spring-mvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springMVC/">springMVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springcloud/">springcloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqoop/">sqoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/struts2/">struts2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uml/">uml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vert-x/">vert.x</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web安全/">web安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xa/">xa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/">xml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式/">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发/">并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微服务/">微服务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/译/">译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔/">随笔</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.imhan.com">Hanny&#39;s Blog</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.chepoo.com">IT技术精华网</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">只想做个好程序员!</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">kongwenqiang</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">kongwenqiang</a></h1>
            </hgroup>
            
            <p class="header-subtitle">我喜欢GO</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:leokongwq@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/leokongwq" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-golang-flag" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/16/golang-flag.html" class="article-date">
      <time datetime="2016-10-16T01:21:25.000Z" itemprop="datePublished">2016-10-16</time>
</a>

 
    <a href="/2016/10/16/golang-flag.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/16/golang-flag.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/16/golang-flag.html">golang命令行参数解析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>在写命令行程序（工具、server）时，对命令参数进行解析是常见的需求。各种语言一般都会提供解析命令行参数的方法或库，以方便程序员使用。如果命令行参数纯粹自己写代码解析，对于比较复杂的，还是挺费劲的。在go标准库中提供了一个包：flag，方便进行命令行解析。</p>
</blockquote>
<h3 id="定义参数"><a href="#定义参数" class="headerlink" title="定义参数"></a>定义参数</h3><h3 id="flag包有2种定义参数的方式"><a href="#flag包有2种定义参数的方式" class="headerlink" title="flag包有2种定义参数的方式:"></a>flag包有2种定义参数的方式:</h3><p><strong>1）flag.Xxx()，其中Xxx可以是Int、String等；返回一个相应类型的指针，如：</strong></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ip = flag.Int(<span class="string">"flagname"</span>, <span class="number">1234</span>, <span class="string">"help message for flagname"</span>)</span>
</pre></td></tr></table></figure>
<p><strong>flagname</strong>：是参数名<br><strong>123</strong>：是参数的默认值<br><strong>help…</strong>:是参数的描述信息</p>
<p><strong>2）flag.XxxVar()，将flag绑定到一个变量上，如：</strong></p>
<p>//如果想将参数的值存到一个变量中，可以通过下面的方式：<br>var flagvar int<br>flag.IntVar(&amp;flagvar, “flagname”, 1234, “help message for flagname”)</p>
<p>除了上面两种方式外，还可以创建自定义flag，只要实现flag.Value接口即可（要求receiver是指针），这时候可以通过如下方式定义该flag：</p>
<p>flag.Var(&amp;flagVal, “name”, “help message for flagname”)</p>
<p><strong>注意</strong>，这种方式参数是没有默认值的，所以默认值就是该类型的零值</p>
<h3 id="解析参数"><a href="#解析参数" class="headerlink" title="解析参数"></a>解析参数</h3><p>flag.Parse()<br>//调用完Parse函数后，就可以使用定义的变量了</p>
<h3 id="参数语法格式"><a href="#参数语法格式" class="headerlink" title="参数语法格式"></a>参数语法格式</h3><p>命令行flag的语法有如下三种形式：<br>-flag // 只支持bool类型<br>-flag=x<br>-flag x // 只支持非bool类型</p>
<p>其中第三种形式只能用于非bool类型的flag，原因是：如果支持，那么对于这样的命令 cmd -x *，如果有一个文件名字是：0或false等，则命令的愿意会改变（之所以这样，是因为bool类型支持-flag这种形式，如果bool类型不支持-flag这种形式，则bool类型可以和其他类型一样处理。也正因为这样，Parse()中，对bool类型进行了特殊处理）。默认的，提供了-flag，则对应的值为true，否则为flag.Bool/BoolVar中指定的默认值；如果希望显示设置为false则使用-flag=false。</p>
<p>int类型可以是十进制、十六进制、八进制甚至是负数；bool类型可以是1, 0, t, f, true, false, TRUE, FALSE, True, False。Duration可以接受任何time.ParseDuration能解析的类型</p>
<h3 id="类型和函数"><a href="#类型和函数" class="headerlink" title="类型和函数"></a>类型和函数</h3><p>在看类型和函数之前，先看一下变量<br>ErrHelp：该错误类型用于当命令行指定了-help参数但没有定义时。<br>Usage：这是一个函数，用户输出所有定义了的命令行参数和帮助信息（usage message）。一般，当命令行参数解析出错时，该函数会被调用。我们可以指定自己的Usage函数，即：flag.Usage = func(){}</p>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p>go标准库中，经常这么做：</p>
<blockquote>
<p>定义了一个类型，提供了很多方法；为了方便使用，会实例化一个该类型的实例（通用），这样便可以直接使用该实例调用方法。比如：encoding/base64中提供了StdEncoding和URLEncoding实例，使用时：base64.StdEncoding.Encode()</p>
</blockquote>
<p>在flag包中，进行了进一步封装：将FlagSet的方法都重新定义了一遍，也就是提供了一序列函数，而函数中只是简单的调用已经实例化好了的FlagSet实例：commandLine 的方法，这样commandLine实例便不需要export。这样，使用者是这么调用：flag.Parse()而不是flag.commandLine.Parse()</p>
<h3 id="类型（数据结构）"><a href="#类型（数据结构）" class="headerlink" title="类型（数据结构）"></a>类型（数据结构）</h3><p><strong>1）ErrorHandling</strong></p>
<p>type ErrorHandling int</p>
<p>该类型定义了在参数解析出错时错误处理方式定义了三个该类型的常量：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span>
<span class="line">    ContinueOnError ErrorHandling = <span class="literal">iota</span></span>
<span class="line">    ExitOnError</span>
<span class="line">    PanicOnError</span>
<span class="line">)</span>
</pre></td></tr></table></figure>
<p>三个常量在源码的FlagSet方法parseOne()中使用了。</p>
<p><strong>2）Flag</strong></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">// A Flag represents the state of a flag.</span></span>
<span class="line"><span class="keyword">type</span> Flag <span class="keyword">struct</span> &#123;</span>
<span class="line">    Name     <span class="keyword">string</span> <span class="comment">// name as it appears on command line</span></span>
<span class="line">    Usage    <span class="keyword">string</span> <span class="comment">// help message</span></span>
<span class="line">    Value    Value  <span class="comment">// value as set</span></span>
<span class="line">    DefValue <span class="keyword">string</span> <span class="comment">// default value (as text); for usage message</span></span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>Flag类型代表一个flag的状态。</p>
<p>比如：<code>autogo -f abc.txt</code>，代码 <code>flag.String(“f”, “a.txt”, “usage”)</code>,则该Flag实例（可以通过flag.Lookup(“f”)获得）相应的值为：f, usage, abc.txt, a.txt。</p>
<p><strong>3）FlagSet</strong></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">// A FlagSet represents a set of defined flags.</span></span>
<span class="line"><span class="keyword">type</span> FlagSet <span class="keyword">struct</span> &#123;</span>
<span class="line">    <span class="comment">// Usage is the function called when an error occurs while parsing flags.</span></span>
<span class="line">    <span class="comment">// The field is a function (not a method) that may be changed to point to</span></span>
<span class="line">    <span class="comment">// a custom error handler.</span></span>
<span class="line">    Usage <span class="function"><span class="keyword">func</span><span class="params">()</span></span>
<span class="line">    <span class="title">name</span> <span class="title">string</span> // <span class="title">FlagSet</span>的名字。<span class="title">commandLine</span>给的是<span class="title">os</span>.<span class="title">Args</span>[0]</span>
<span class="line">    <span class="title">parsed</span> <span class="title">bool</span> // 是否执行过<span class="title">Parse</span><span class="params">()</span></span>
<span class="line">    <span class="title">actual</span> <span class="title">map</span>[<span class="title">string</span>]*<span class="title">Flag</span> // 存放实际传递了的参数（即命令行参数）</span>
<span class="line">    <span class="title">formal</span> <span class="title">map</span>[<span class="title">string</span>]*<span class="title">Flag</span> // 存放所有已定义命令行参数</span>
<span class="line">    <span class="title">args</span> []<span class="title">string</span> // <span class="title">arguments</span> <span class="title">after</span> <span class="title">flags</span> // 存放非<span class="title">flag</span>（<span class="title">non</span>-<span class="title">flag</span>）参数</span>
<span class="line">    <span class="title">exitOnError</span> <span class="title">bool</span> // <span class="title">does</span> <span class="title">the</span> <span class="title">program</span> <span class="title">exit</span> <span class="title">if</span> <span class="title">there</span>'<span class="title">s</span> <span class="title">an</span> <span class="title">error</span>?</span>
<span class="line">    <span class="title">errorHandling</span> <span class="title">ErrorHandling</span> // 当解析出错时，处理错误的方式</span>
<span class="line">    <span class="title">output</span> <span class="title">io</span>.<span class="title">Writer</span> // <span class="title">nil</span> <span class="title">means</span> <span class="title">stderr</span>; <span class="title">use</span> <span class="title">out</span><span class="params">()</span> <span class="title">accessor</span></span>
<span class="line">&#125;</span></span>
</pre></td></tr></table></figure>
<p><strong>4）Value接口</strong></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">// Value is the interface to the dynamic value stored in a flag.</span></span>
<span class="line"><span class="comment">// (The default value is represented as a string.)</span></span>
<span class="line"><span class="keyword">type</span> Value <span class="keyword">interface</span> &#123;</span>
<span class="line">    String() <span class="keyword">string</span></span>
<span class="line">    Set(<span class="keyword">string</span>) error</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>所有参数类型需要实现Value接口，flag包中，为int、float、bool等实现了该接口。借助该接口，我们可以自定义flag</p>
<h3 id="主要类型的方法（包括类型实例化）"><a href="#主要类型的方法（包括类型实例化）" class="headerlink" title="主要类型的方法（包括类型实例化）"></a>主要类型的方法（包括类型实例化）</h3><p>flag包中主要是FlagSet类型。</p>
<h4 id="1、实例化方式"><a href="#1、实例化方式" class="headerlink" title="1、实例化方式"></a>1、实例化方式</h4><p>NewFlagSet()用于实例化FlagSet。预定义的FlagSet实例commandLine的定义方式：</p>
<pre><code>// The default set of command-line flags, parsed from os.Args.
var commandLine = NewFlagSet(os.Args[0], ExitOnError)
</code></pre><p>可见，默认的FlagSet实例在解析出错时会提出程序。</p>
<p>由于FlagSet中的字段没有export，其他方式获得FlagSet实例后，比如：FlagSet{}或new(FlagSet)，应该调用Init()方法，初始化name和errorHandling。</p>
<h4 id="2、定义flag参数方法"><a href="#2、定义flag参数方法" class="headerlink" title="2、定义flag参数方法"></a>2、定义flag参数方法</h4><p>这一序列的方法都有两种形式，在一开始已经说了两种方式的区别。这些方法用于定义某一类型的flag参数。</p>
<h4 id="3、解析参数（Parse）"><a href="#3、解析参数（Parse）" class="headerlink" title="3、解析参数（Parse）"></a>3、解析参数（Parse）</h4><p>func (f *FlagSet) Parse(arguments []string) error</p>
<p>从参数列表中解析定义的flag。参数arguments不包括命令名，即应该是os.Args[1:]。事实上，flag.Parse()函数就是这么做的：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">// Parse parses the command-line flags from os.Args[1:].  Must be called</span></span>
<span class="line"><span class="comment">// after all flags are defined and before flags are accessed by the program.</span></span>
<span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Parse</span><span class="params">()</span></span> &#123;</span>
<span class="line">    <span class="comment">// Ignore errors; commandLine is set for ExitOnError.</span></span>
<span class="line">    commandLine.Parse(os.Args[<span class="number">1</span>:])</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>该方法应该在flag参数定义后而具体参数值被访问前调用。</p>
<p>如果提供了-help参数（命令中给了）但没有定义（代码中），该方法返回ErrHelp错误。默认的commandLine，在Parse出错时会退出（ExitOnError）</p>
<p>为了更深入的理解，我们看一下Parse(arguments []string)的源码：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
</pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *FlagSet)</span> <span class="title">Parse</span><span class="params">(arguments []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span>
<span class="line">    f.parsed = <span class="literal">true</span></span>
<span class="line">    f.args = arguments</span>
<span class="line">    <span class="keyword">for</span> &#123;</span>
<span class="line">        seen, err := f.parseOne()</span>
<span class="line">        <span class="keyword">if</span> seen &#123;</span>
<span class="line">            <span class="keyword">continue</span></span>
<span class="line">        &#125;</span>
<span class="line">        <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span>
<span class="line">            <span class="keyword">break</span></span>
<span class="line">        &#125;</span>
<span class="line">        <span class="keyword">switch</span> f.errorHandling &#123;</span>
<span class="line">        <span class="keyword">case</span> ContinueOnError:</span>
<span class="line">            <span class="keyword">return</span> err</span>
<span class="line">        <span class="keyword">case</span> ExitOnError:</span>
<span class="line">            os.Exit(<span class="number">2</span>)</span>
<span class="line">        <span class="keyword">case</span> PanicOnError:</span>
<span class="line">            <span class="built_in">panic</span>(err)</span>
<span class="line">        &#125;</span>
<span class="line">    &#125;</span>
<span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>真正解析参数的方法是非导出方法parseOne。结合parseOne方法，我们来解释non-flag以及包文档中的这句话：</p>
<pre><code>Flag parsing stops just before the first non-flag argument (“-” is a non-flag argument) or after the terminator “–”.
</code></pre><p>我们需要了解解析什么时候停止.根据Parse()中for循环终止的条件（不考虑解析出错），我们知道，当parseOne返回false, nil时，Parse解析终止。正常解析完成我们不考虑。看一下parseOne的源码发现，有两处会返回false, nil。</p>
<p><strong>1）第一个non-flag参数</strong></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line">s := f.args[<span class="number">0</span>]</span>
<span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">0</span> || s[<span class="number">0</span>] != <span class="string">'-'</span> || <span class="built_in">len</span>(s) == <span class="number">1</span> &#123;</span>
<span class="line">    <span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>也就是，当遇到单独的一个”-”或不是”-”开始时，会停止解析。比如：</p>
<pre><code>./autogo – -f或./autogo build -f
</code></pre><p>这两种情况，-f都不会被正确解析。像该例子中的”-”或build（以及之后的参数），我们称之为non-flag参数</p>
<p><strong>2）两个连续的”–”</strong></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> s[<span class="number">1</span>] == <span class="string">'-'</span> &#123;</span>
<span class="line">    num_minuses++</span>
<span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">2</span> &#123; <span class="comment">// "--" terminates the flags</span></span>
<span class="line">        f.args = f.args[<span class="number">1</span>:]</span>
<span class="line">        <span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>也就是，当遇到连续的两个”-”时，解析停止。</p>
<p>说明：这里说的”-”和”–”，位置和”-f”这种的一样。也就是说，下面这种情况并不是这里说的：</p>
<pre><code>./autogo -f -
</code></pre><p>这里的”–”会被当成是f的值</p>
<p>parseOne方法中接下来是处理-flag=x，然后是-flag（bool类型）（这里对bool进行了特殊处理），接着是-flag x这种形式，最后，将解析成功的Flag实例存入FlagSet的actual map中。</p>
<p>另外，在parseOne中有这么一句：</p>
<pre><code>f.args = f.args[1:]
</code></pre><p>也就是说，每执行成功一次parseOne，f.args会少一个。所以，FlagSet中的args最后留下来的就是所有non-flag参数。</p>
<p><strong>3、Arg(i int)和Args()、NArg()、NFlag()</strong></p>
<p>Arg(i int)和Args()这两个方法就是获取non-flag参数的；NArg()获得non-flag个数；NFlag()获得FlagSet中actual长度（即被设置了的参数个数）。</p>
<p><strong>4、Visit/VisitAll</strong></p>
<p>这两个函数分别用户访问FlatSet的actual和formal中的Flag，而具体的访问方式由调用者决定。</p>
<p><strong>5、PrintDefaults()</strong></p>
<p>打印所有已定义参数的默认值（调用VisitAll），默认输出到标准错误，除非指定了FlagSet的output（通过SetOutput()设置）</p>
<p><strong>6、Set(name, value string)</strong><br>设置某个flag的值（通过Flag的name）</p>
<h3 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h3><p>使用建议：虽然上面讲了那么多，一般来说，我们只简单的定义flag，然后parse，就如同开始的例子一样。如果项目需要复杂或更高级的命令行解析方式，可以试试<a href="https://github.com/polaris1119/goptions" target="_blank" rel="external">goptions</a>包如果想要像go工具那样的多命令（子命令）处理方式，可以试试<a href="https://github.com/polaris1119/command" target="_blank" rel="external">command</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/golang/">golang</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/">go</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
    <article id="post-golang-file" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/16/golang-file.html" class="article-date">
      <time datetime="2016-10-16T01:21:17.000Z" itemprop="datePublished">2016-10-16</time>
</a>

 
    <a href="/2016/10/16/golang-file.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/16/golang-file.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/16/golang-file.html">golang文件操作</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <blockquote>
<p>文件操作是大多数编程语言必不可少的功能. 在GO中,它提供了文件操作所需的各种API, 包括文件的创建,删除,读写,权限设置等操作.下面就介绍下GO中常见的文件操作.</p>
</blockquote>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/golang/">golang</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/">go</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2016/10/16/golang-file.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
    <article id="post-golang-userinfo" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/16/golang-userinfo.html" class="article-date">
      <time datetime="2016-10-16T01:12:01.000Z" itemprop="datePublished">2016-10-16</time>
</a>

 
    <a href="/2016/10/16/golang-userinfo.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/16/golang-userinfo.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/16/golang-userinfo.html">golang 用户信息获取</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h3 id="golang-用户信息获取"><a href="#golang-用户信息获取" class="headerlink" title="golang 用户信息获取"></a>golang 用户信息获取</h3><h3 id="获取当前用户"><a href="#获取当前用户" class="headerlink" title="获取当前用户"></a>获取当前用户</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"os/user"</span></span>
<span class="line"></span>
<span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span>
<span class="line">    crtUser, err := user.Current()</span>
<span class="line">&#125;</span>
<span class="line">crtUser 的类型是：*User, 具体如下：</span>
<span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span>
<span class="line">	Uid      <span class="keyword">string</span> <span class="comment">// user id</span></span>
<span class="line">	Gid      <span class="keyword">string</span> <span class="comment">// primary group id</span></span>
<span class="line">	Username <span class="keyword">string</span></span>
<span class="line">	Name     <span class="keyword">string</span></span>
<span class="line">	HomeDir  <span class="keyword">string</span></span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/golang/">golang</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/">go</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2016/10/16/golang-userinfo.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
    <article id="post-golang-time" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/16/golang-time.html" class="article-date">
      <time datetime="2016-10-16T01:09:19.000Z" itemprop="datePublished">2016-10-16</time>
</a>

 
    <a href="/2016/10/16/golang-time.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/16/golang-time.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/16/golang-time.html">golang时间操作</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <blockquote>
<p>对时间操作的操作是日常编码中长的操作, 一个好的日期时间操作库能提供编码的效率并减少bug的产生; golang有自己的时间操作库, 在它的<code>time</code>包,下面就介绍少在GO中如何操作时间.</p>
</blockquote>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/golang/">golang</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/">go</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2016/10/16/golang-time.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
    <article id="post-java-BlockingQueue" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/16/java-BlockingQueue.html" class="article-date">
      <time datetime="2016-10-16T01:08:16.000Z" itemprop="datePublished">2016-10-16</time>
</a>

 
    <a href="/2016/10/16/java-BlockingQueue.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/16/java-BlockingQueue.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/16/java-BlockingQueue.html">Java的BlockingQueue详解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h3 id="Java的BlockingQueue详解"><a href="#Java的BlockingQueue详解" class="headerlink" title="Java的BlockingQueue详解"></a>Java的BlockingQueue详解</h3><h3 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h3><blockquote>
<p>Java的BlockingQueue本质上还是一个Queue（队列），它其实是在队列的基础功能上添加了如下功能：<br>1.队列为空时获取数据导致当前线程等待<br>2.队列没有多余空间时，导致添加元素到队列的线程等待<br>BlockingQueue提供了4中不同的方式供用户获取队列元素或添加元素到队列，这4种类型的方法导致4种不同的行为：1：抛异常；2：返回特殊值，false或null；3：阻塞当前线程；4：超时阻塞</p>
</blockquote>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/java/">java</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2016/10/16/java-BlockingQueue.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
    <article id="post-java-runnable-callable-future" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/16/java-runnable-callable-future.html" class="article-date">
      <time datetime="2016-10-16T01:04:10.000Z" itemprop="datePublished">2016-10-16</time>
</a>

 
    <a href="/2016/10/16/java-runnable-callable-future.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/16/java-runnable-callable-future.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/16/java-runnable-callable-future.html">Java中的Runnable、Callable、Future、FutureTask的区别与示例</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <blockquote>
<p>Java中存在Runnable、Callable、Future、FutureTask这几个与线程相关的类或者接口，在Java中也是比较重要的几个概念，我们通过下面的简单示例来了解一下它们的作用于区别。 </p>
</blockquote>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/java/">java</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2016/10/16/java-runnable-callable-future.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
    <article id="post-java-Queue" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/15/java-Queue.html" class="article-date">
      <time datetime="2016-10-15T13:12:40.000Z" itemprop="datePublished">2016-10-15</time>
</a>

 
    <a href="/2016/10/15/java-Queue.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/15/java-Queue.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/15/java-Queue.html">java队列Queue接口详解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h3 id="Queue接口简介"><a href="#Queue接口简介" class="headerlink" title="Queue接口简介"></a>Queue接口简介</h3><p>java中的队列接口Queue是一个被设计用来按一定的优先级处理元素的集合，除了拥有基本的集合操作和数据结构队列的特性外它还添加了额外的元素插入，获取，检查操作。所有的这些额外添加的操作都有一个共性，如果操作失败，一种情况是：抛出异常；一种情况是：返回特殊的值(根据情况可能是null或false)。返回特殊值这种方式是针对有容量队列的插入操作。在大多数队列的实现中插入操作是不能失败的。</p>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/java/">java</a>
    </div>


      
      
        <p class="article-more-link">
          <a href="/2016/10/15/java-Queue.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
    <article id="post-strace-learn" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/15/strace-learn.html" class="article-date">
      <time datetime="2016-10-15T11:56:57.000Z" itemprop="datePublished">2016-10-15</time>
</a>

 
    <a href="/2016/10/15/strace-learn.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/15/strace-learn.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/15/strace-learn.html">手把手教你用Strace诊断问题</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <blockquote>
<p>早些年，如果你知道有个 strace 命令，就很牛了，而现在大家基本都知道 strace 了，如果你遇到性能问题求助别人，十有八九会建议你用 strace 挂上去看看，不过当你挂上去了，看着满屏翻滚的字符，却十有八九看不出个所以然。本文通过一个简单的案例，向你展示一下在用 strace 诊断问题时的一些套路。如下真实案例，如有雷同，实属必然！让我们看一台高负载服务器的 top 结果：</p>
</blockquote>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/linux/">linux</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2016/10/15/strace-learn.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
    <article id="post-too-many-open-files" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/15/too-many-open-files.html" class="article-date">
      <time datetime="2016-10-15T11:56:48.000Z" itemprop="datePublished">2016-10-15</time>
</a>

 
    <a href="/2016/10/15/too-many-open-files.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/15/too-many-open-files.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/15/too-many-open-files.html">too-many-open-files</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h3 id="故障总结："><a href="#故障总结：" class="headerlink" title="故障总结："></a>故障总结：</h3><blockquote>
<p>不要被经验主义羁绊；生产环境的进程管理工具Supervisor等的原理和限制需要理解清楚。</p>
</blockquote>
<p>昨天，项目的 ElasticSearch 服务挂了，我说的挂可不是进程没了，因为有 Supervisor 保护，而是服务不可用了。以前曾经出现过一次因为 ES_HEAP_SIZE 设置不当导致的服务不可用故障，于是我惯性的判断应该还是 ES_HEAP_SIZE 的问题，不过登录服务器后发现日志里显示大量的「Too many open files」错误信息。那么 ElasticSearch 设置的最大文件数到底是多少呢？可以通过 proc 确认：</p>
<pre><code>shell&gt; cat /proc/&lt;PID&gt;/limits
</code></pre><p>结果是「4096」，我们还可以进一步看看 ElasticSearch 打开的都是什么东西：</p>
<pre><code>shell&gt; ls /proc/&lt;PID&gt;/fd
</code></pre>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/java/">java</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2016/10/15/too-many-open-files.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
    <article id="post-linux-strace" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/10/15/linux-strace.html" class="article-date">
      <time datetime="2016-10-15T11:56:39.000Z" itemprop="datePublished">2016-10-15</time>
</a>

 
    <a href="/2016/10/15/linux-strace.html#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/10/15/linux-strace.html"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/15/linux-strace.html">linux工具-strace</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <blockquote>
<p>truss和strace都是用来跟踪一个进程的系统调用或信号产生的情况，而 ltrace用来 跟踪进程调用库函数的情况。</p>
</blockquote>
<h3 id="strace用法"><a href="#strace用法" class="headerlink" title="strace用法"></a>strace用法</h3><pre><code>usage: strace [-dDffhiqrtttTvVxx] [-a column] [-e expr] ... [-o file]
          [-p pid] ... [-s strsize] [-u username] [-E var=val] ...
          [command [arg ...]]
   or: strace -c [-D] [-e expr] ... [-O overhead] [-S sortby] [-E var=val] ...
          [command [arg ...]]                        
</code></pre>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/golang/">golang</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/">go</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2016/10/15/linux-strace.html#more">阅读全文 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>






  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/27/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="page-number" href="/page/27/">27</a><span class="page-number current">28</span><a class="page-number" href="/page/29/">29</a><a class="page-number" href="/page/30/">30</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/29/">Next &raquo;</a>
    </nav>
  

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2018 kongwenqiang
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>


    

    
        <script id="dsq-count-scr" src="//leokongwq.disqus.com/count.js" async></script>
        <script>
            if ($(".left-col").is(":visible")) {
                var $disqusCount = $(".disqus-comment-count");
                $disqusCount.bind("DOMNodeInserted", function(e) {
                    var num = $(this).text().replace(/[^0-9]/ig,"");
                    if (num > 0) {
                        $(this).siblings(".count-comment").text(num);
                    }
                    $(this).remove();
                })
            } else {
                $(".disqus-comment-count").remove();
            }
        </script>
     




<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<script>
    var inputArea = document.querySelector("#local-search-input");
    var getSearchFile = function(){
        var path = "/search.xml";
        alert(11111);
        searchFunc(path, 'local-search-input', 'local-search-result');
    }
    inputArea.onfocus = function(){
      getSearchFile()
    }

    var $resetButton = $("#search-form .fa-times");

    var $resultArea = $("#local-search-result");
    inputArea.oninput = function(){ $resetButton.show(); }

    resetSearch = function(){
        $resultArea.html("");
        document.querySelector("#search-form").reset();
        $resetButton.hide();
        $(".no-result").hide();
    }

    inputArea.onkeydown = function(){
        if(event.keyCode==13) {
          return false
        }
    }

    $resultArea.bind("DOMNodeRemoved DOMNodeInserted", function(e) {
        if (!$(e.target).text()) {
            $(".no-result").show(200);
        } else {
          $(".no-result").hide();
        }
    })

</script>

  </div>
</body>
</html>